generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}
enum Role {
  STUDENT
  ADMIN
  SUPER_ADMIN
  DEPARTMENT
  CLEARANCE_OFFICER
  POLICE_OFFICER
  LIBRARY_OFFICER
}


model User {
  id                Int                @id @default(autoincrement())
  full_name         String
  email             String             @unique
  password          String
  role              Role
  departmentId      Int?
  isTempPassword  Boolean   @default(true)
  department        Department?        @relation(fields: [departmentId], references: [id], name: "UserDepartment")
  studentClearances ClearanceRequest[] @relation("StudentClearances")
}

model Department {
  id                          Int                         @id @default(autoincrement())
  name                        String                      @unique
  users                       User[]                      @relation("UserDepartment")
  departmentClearanceStatuses DepartmentClearanceStatus[]
}

model ClearanceRequest {
  id                 Int                         @id @default(autoincrement())
  studentId          Int                         @map("student_id")
  departmentId       Int                         @map("department_id")   
  overallStatus      String                      @map("overall_status") @default("Pending")
  createdAt          DateTime                    @default(now())
  student            User                        @relation("StudentClearances", fields: [studentId], references: [id])
  departmentStatuses DepartmentClearanceStatus[]

  @@index([studentId])
}


model DepartmentClearanceStatus {
  id                   Int      @id @default(autoincrement())
  clearance_request_id Int
  department_id        Int
  status               String   @default("Pending")
  comment              String? // optional
  updated_at           DateTime @default(now()) @updatedAt

  clearanceRequest ClearanceRequest @relation(fields: [clearance_request_id], references: [id])
  department       Department       @relation(fields: [department_id], references: [id])

  @@index([clearance_request_id])
  @@index([department_id])
}
